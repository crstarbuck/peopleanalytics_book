# Data Visualization {#data-viz}

  Unlike content in the preceding chapters, data visualization is more of an *art* than a *science*. Data visualization is heavily dependent on the type of data being presented, key messages that need to be conveyed, the unique characteristics of the audience to whom information needs to be communicated, and various contextual features germane to a proper interpretation and understanding of material.
  
  This chapter will provide general best practices as well as strategies specific to various types of data that will promote success when communicating data to technical and non-technical stakeholders alike.
  
## Best Practices

  While the type of visual depends on the nature of data being presented, there are general best practices for effectively communicating information that are applicable for all data types, audiences, and contexts.

### Color Palette

  There are several important considerations when choosing colors for data visualization. 
  
  **Color has meaning.**
  
  The meaning of color is not consistent across the world. For example, in Western cultures red generally has unfavorable connotations (e.g., off track, danger) while green signals a favorable status (e.g., on track, cash flow positive). However, in Asian cultures red indicates success. 
  
  It is important to understand what color indicates in the contexts in which information is shared to ensure color choices are consistent with the messages that need to be conveyed.
  
  **Respect color blindness.**

  Most estimates indicate that 1 in 12 men (8%) and 1 in 200 women (0.5%) are colorblind (~4.5% of the world population). Males are more likely to be colorblind because the X chromosome contains the genes responsible for the most common forms of color blindness. Trouble distinguishing between red and green is the most common manifestation of colorblindness (Gordon, 1998).
  
  This has important implications for data visualization, and it is generally best to avoid the use of red and green. One alternative is to leverage orange to indicate unfavorable data points and blue for favorable. This strategy will be implemented throughout this chapter.

  **Adhere to brand colors.**
  
  In most organizations, the marketing team defines a color palette consistent with the branding used for consumer products and services. In this case, analysts may be constrained to the use of colors within the branding palette. 
  
  Be sure to consult with marketing colleagues and adhere to any color palette requirements.

  **Use color consistently.**

  To support a correct interpretation of information, it is important to use a consistent color scheme across the various visuals in dashboards, slides, and documents. For example, if blue is assigned to highlight how the Engineering department compares to other departments in a particular view, blue should be assigned to the Engineering department in every view in which department is a grouping dimension. 
  
  The consistent use of color requires the audience to wield less effort to understand information, which in turn reduces the risk of incorrect interpretation.

### Chart Borders

  The goal in data visualization is to enable the most important data to take center stage. Formatting should support -- not detract -- from this objective. Chart borders are a usual suspect and prime example of formatting that can divert focus away from the data.
  
  Figure \@ref(fig:chart-borders) illustrates the use of heavy and light borders for a tabular presentation of data. Formatting takes center stage in the first table due to heavy borders, while formatting is not the focus in the second table given the minimal light grey border.
  
```{r chart-borders, out.width = "75%", echo = FALSE, fig.cap = 'Comparison of data tables with heavy (left) and light (right) borders.', fig.align = 'center'}

knitr::include_graphics("/Users/craig.starbuck/Library/Mobile Documents/com~apple~CloudDocs/Documents/People Analytics Book/GitHub/peopleanalytics_book/graphics/light_heavy_borders.png")

```

### Zero Baseline

  

### Preattentive Attributes
  
  **Preattentive attributes** signal where to look and help our audience focus on content we wish to emphasize (Knaflic, 2015). 
  
  It is important to remember that data do not always need to be visualized with a chart. Sometimes communicating with text is a sufficient and effective way to convey information. In the case of text, preattentive attributes are often implemented using bold text and/or contrasting colors for keywords and phrases that need to take center stage. **Bolded** text is generally more effective than *italizing* or \underline{underlining}, as it highlights the chosen elements without unnecessary noise and compromising legibility.
  
  Grey is an important color in the implementation of preattentive attributes as it facilitates a move of less important data and design elements to the background to make room for more predominate colors to highlight the most important information. Figure \@ref(fig:pre-attr-1) illustrates the application of preattentive attributes to emphasize the key message in a sentence. This is accomplished by pushing the less important content to the background using grey text and using bold orange text to highlight the labor cost increase.
  
```{r pre-attr-1, out.width = "75%", echo = FALSE, fig.cap = 'The application of preattentive attributes to highlight labor costs as a key driver of operating cost increases.', fig.align = 'center', message = FALSE, warning = FALSE}

knitr::include_graphics("/Users/craig.starbuck/Library/Mobile Documents/com~apple~CloudDocs/Documents/People Analytics Book/GitHub/peopleanalytics_book/graphics/preattentive_attributes.png")

```
  
  Preattentive attributes can also be applied to data visualizations to focus the audience's attention. Figure \@ref(fig:pre-attr-2) illustrates the use of preattentive attributes by assigning a different color (orange) to the labor cost for the current year and muting the labor costs associated with prior years using a less predominate grey.
  
```{r pre-attr-2, out.width = "100%", echo = FALSE, fig.cap = 'The application of preattentive attributes to highlight labor costs for the current year relative to prior years.', fig.align = 'center', message = FALSE, warning = FALSE}

# Load library
library(ggplot2)

# Create data
year <- c('2022', '2021', '2020', '2019')
labor_cost <- c(219700000, 169000000, 130000000, 100000000)
lc_data <- data.frame(year, labor_cost)

# Visualize data
ggplot2::ggplot(lc_data, aes(x = year, y = labor_cost * .000001, fill = year)) + 
ggplot2::labs(x = 'Year', y = 'Labor Cost (in millions of USD)') +
ggplot2::geom_bar(stat = "identity") +
ggplot2::coord_flip() +
ggplot2::scale_fill_manual(values = c("2022" = "#ED7D31", "2021" = "grey", "2020" = "grey", "2019" = "grey")) +
ggplot2::theme(panel.background = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank(),
               axis.title.x = element_text(colour = "#404040", margin = margin(t = 10, r = 0, b = 0, l = 0)),
               axis.title.y = element_text(colour = "#404040", margin = margin(t = 0, r = 10, b = 0, l = 0)),
               legend.position = "none")

```

  Simply put, if something is **really important**, make sure it is different from other content on the page, slide, or section.

## Beyond the Defaults

  Software knows neither what we wish to highlight nor the audience to whom we intend to communicate the information. Therefore, regardless of the software, design defaults are rarely best. 
  
  This section will implement data visualization best practices step-by-step beginning with the design defaults for the `ggplot2` library.

### Step 1: Build Bar Chart with Defaults

  We will begin by building a bar chart that shows the distribution of active employees' educational backgrounds. To simplify the data structure for data visualization, let's ingest our `employees` data and create an aggregated cube with counts by `ed_field` for active employees:
  
```{r, message = FALSE, warning = FALSE}

# Load library
library(dplyr)

# Load data
employees <- read.csv("https://raw.githubusercontent.com/crstarbuck/peopleanalytics_book/master/data/employees.csv")

# Create data cube for active employees
smmry_ed_field <- employees %>%
                  dplyr::filter(active == 'Yes') %>%
                  dplyr::count(ed_field)

```

  A bar chart can be created using the `geom_bar()` function, and we will start with the `ggplot2` library's design defaults:

```{r barchart_1, out.width = "100%", fig.cap = 'Step 1: Bar chart with defaults.', fig.align = 'center', message = FALSE, warning = FALSE}

# Visualize data
ggplot2::ggplot(data, aes(x = ed_field, y = n, fill = as.factor(ed_field))) +
ggplot2::geom_bar(stat = "identity") 

```

### Step 2: Remove Legend

  Since the legend is not necessary for interpreting the education field to which each bar corresponds, we will remove it using `theme(legend.position = "none")`. Eliminating the legend also provides more real estate for the chart, which helps make the x-axis values more legible.

```{r barchart_2, out.width = "100%", echo = FALSE, fig.cap = 'Step 3: Remove legend.', fig.align = 'center', message = FALSE, warning = FALSE}

# Visualize data
ggplot2::ggplot(smmry_ed_field, aes(x = ed_field, y = n, fill = as.factor(ed_field))) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::theme(legend.position = "none")

```

### Step 3: Assign Colors Strategically

  There is a lot competing for attention due to this vibrant color palette. Let's assume that the objective is to highlight the education field pursued by the largest number of employees. Preattentive attributes lends well to this, and we can assign specific hex color codes to the education categories. 
  
  Since Life Sciences was the field pursued by the most employees, let's highlight the corresponding bar in blue and move the remaining bars to the background through the assignment of light grey. One method of accomplishing this is via the following explicit category assignments:
  
`scale_fill_manual(values = c("Human Resources" = "#BFBFBF", "Life Sciences" = "#0070C0", "Marketing" = "#BFBFBF", "Medical" = "#BFBFBF", "Other" = "#BFBFBF", Technical Degree" = "#BFBFBF"))`

```{r barchart_3, out.width = "100%", echo = FALSE, fig.cap = 'Step 3: Assign colors strategically.', fig.align = 'center', message = FALSE, warning = FALSE}

# Visualize data
ggplot2::ggplot(smmry_ed_field, aes(x = ed_field, y = n, fill = as.factor(ed_field))) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::scale_fill_manual(values = c("Human Resources" = "#BFBFBF", 
                                      "Life Sciences" = "#0070C0", 
                                      "Marketing" = "#BFBFBF", 
                                      "Medical" = "#BFBFBF",
                                      "Other" = "#BFBFBF",
                                      "Technical Degree" = "#BFBFBF")) +
ggplot2::theme(legend.position = "none")

```

### Step 4: Add Mixed Case Axis Titles

  Axis titles are the column names by default, which is usually not the most user-friendly option. We can assign new mixed case axis titles by chaining `labs(x = 'Education Field', y = 'Headcount')` to the visualization code.

```{r barchart_4, out.width = "100%", echo = FALSE, fig.cap = 'Step 4: Add mixed case axis titles.', fig.align = 'center', message = FALSE, warning = FALSE}

# Visualize data
ggplot2::ggplot(smmry_ed_field, aes(x = ed_field, y = n, fill = as.factor(ed_field))) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::labs(x = 'Education Field', y = 'Headcount') +
ggplot2::scale_fill_manual(values = c("Human Resources" = "#BFBFBF", 
                                      "Life Sciences" = "#0070C0", 
                                      "Marketing" = "#BFBFBF", 
                                      "Medical" = "#BFBFBF",
                                      "Other" = "#BFBFBF",
                                      "Technical Degree" = "#BFBFBF")) +
ggplot2::theme(legend.position = "none")

```

### Step 5: Add Left-Justified Title

  We can add a chart title via `labs(title = 'This is a chart title.')`. This title can be centered via `theme(plot.title = element_text(hjust = 0.5)`, left justified via `theme(plot.title = element_text(hjust = 0)`, or right justified via `theme(plot.title = element_text(hjust = 1)`.
  
  It is a best practice to left justify titles since readers consume information beginning with the left side of the page (like reading a book), and left justifying the title increases the probability that the audience will read the title and understand its purpose before engaging with the visual. Left justification is the default for `ggplot2` titles.
  
  It is also a best practice to assign a descriptive title to charts to highlight the key message(s) we want to convey to the audience through the visual. For longer titles, the new line character `\n` can be used to break titles into multiple lines.

```{r barchart_5, out.width = "100%", echo = FALSE, fig.cap = 'Step 5: Add title.', fig.align = 'center', message = FALSE, warning = FALSE}

# Visualize data
ggplot2::ggplot(smmry_ed_field, aes(x = ed_field, y = n, fill = as.factor(ed_field))) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::labs(title = 'Life Sciences is the most common education field \npursued by active employees.', x = 'Education Field', y = 'Headcount') +
ggplot2::scale_fill_manual(values = c("Human Resources" = "#BFBFBF", 
                                      "Life Sciences" = "#0070C0", 
                                      "Marketing" = "#BFBFBF", 
                                      "Medical" = "#BFBFBF",
                                      "Other" = "#BFBFBF",
                                      "Technical Degree" = "#BFBFBF")) +
ggplot2::theme(legend.position = "none",
               plot.title = element_text(hjust = 0))

```

### Step 6: Increase Axis Margins

  Creating a degree of separation between axis titles and the variable's values helps in reducing clutter and enhancing legibility. We can leverage `axis.title.x = element_text(margin = margin(t = 10, r = 10, b = 0, l = 0))` and `axis.title.y = element_text(margin = margin(t = 10, r = 10, b = 0, l = 0))` to set the margins around x-axis and y-axis titles, respectively, where:
  
  * `t` = top
  * `r` = right
  * `b` = bottom
  * `l` = left

```{r barchart_6, out.width = "100%", echo = FALSE, fig.cap = 'Step 6: Increase axis margins.', fig.align = 'center', message = FALSE, warning = FALSE}

# Visualize data
ggplot2::ggplot(smmry_ed_field, aes(x = ed_field, y = n, fill = as.factor(ed_field))) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::labs(title = 'Life Sciences is the most common education field \npursued by active employees.', x = 'Education Field', y = 'Headcount') +
ggplot2::scale_fill_manual(values = c("Human Resources" = "#BFBFBF", 
                                      "Life Sciences" = "#0070C0", 
                                      "Marketing" = "#BFBFBF", 
                                      "Medical" = "#BFBFBF",
                                      "Other" = "#BFBFBF",
                                      "Technical Degree" = "#BFBFBF")) +
ggplot2::theme(legend.position = "none",
               plot.title = element_text(hjust = 0, margin = margin(t = 0, r = 0, b = 10, l = 0)),
               axis.title.x = element_text(margin = margin(t = 10, r = 10, b = 0, l = 0)),
               axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)))

```

### Step 7: Remove Background

  The default grey background is a distraction from the data we need to take center stage. We can remove this background using `panel.background = element_blank()` to achieve a cleaner aesthetic and allow the bars in this chart to become more pronounced. 

```{r barchart_7, out.width = "100%", echo = FALSE, fig.cap = 'Step 7: Remove background.', fig.align = 'center', message = FALSE, warning = FALSE}

# Visualize data
ggplot2::ggplot(smmry_ed_field, aes(x = ed_field, y = n, fill = as.factor(ed_field))) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::labs(title = 'Life Sciences is the most common education field \npursued by active employees.', x = 'Education Field', y = 'Headcount') +
ggplot2::scale_fill_manual(values = c("Human Resources" = "#BFBFBF", 
                                      "Life Sciences" = "#0070C0", 
                                      "Marketing" = "#BFBFBF", 
                                      "Medical" = "#BFBFBF",
                                      "Other" = "#BFBFBF",
                                      "Technical Degree" = "#BFBFBF")) +
ggplot2::theme(legend.position = "none",
               panel.background = element_blank(),
               plot.title = element_text(hjust = 0, margin = margin(t = 0, r = 0, b = 10, l = 0)),
               axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)),
               axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)))

```

### Step 8: Remove Axis Ticks

  Axis ticks add noise to this visual and are not necessary to ascertain to which values along the axes the data align. Axis ticks can be removed for each axis independently with `axis.ticks.x = element_blank()` for the x-axis and `axis.ticks.y = element_blank()` for the y-axis.

```{r barchart_8, out.width = "100%", echo = FALSE, fig.cap = 'Step 8: Remove axis ticks.', fig.align = 'center', message = FALSE, warning = FALSE}

# Visualize data
ggplot2::ggplot(smmry_ed_field, aes(x = ed_field, y = n, fill = as.factor(ed_field))) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::labs(title = 'Life Sciences is the most common education field \npursued by active employees.', x = 'Education Field', y = 'Headcount') +
ggplot2::scale_fill_manual(values = c("Human Resources" = "#BFBFBF", 
                                      "Life Sciences" = "#0070C0", 
                                      "Marketing" = "#BFBFBF", 
                                      "Medical" = "#BFBFBF",
                                      "Other" = "#BFBFBF",
                                      "Technical Degree" = "#BFBFBF")) +
ggplot2::theme(legend.position = "none",
               panel.background = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank(),
               plot.title = element_text(hjust = 0, margin = margin(t = 0, r = 0, b = 10, l = 0)),
               axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)),
               axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)))

```

### Step 9: Mute Titles

  While the chart and axis titles are important for clarifying what information is represented in the visual, these should not be the focus. Just as we pushed the less important education categories to the background using grey text, we can mute the chart and axis titles with grey text to help draw attention to the data.
  
  We can change the color of the chart title to light grey with `plot.title = element_text(colour = "#404040")`. The axis titles can be changed to the same color using `axis.title.x = element_text(colour = "#404040")` for the x-axis and `axis.title.y = element_text(colour = "#404040")` for the y-axis.

```{r barchart_9, out.width = "100%", echo = FALSE, fig.cap = 'Step 9: Mute titles.', fig.align = 'center', message = FALSE, warning = FALSE}

# Visualize data
ggplot2::ggplot(smmry_ed_field, aes(x = ed_field, y = n, fill = as.factor(ed_field))) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::labs(title = 'Life Sciences is the most common education field \npursued by active employees.', x = 'Education Field', y = 'Headcount') +
ggplot2::scale_fill_manual(values = c("Human Resources" = "#BFBFBF", 
                                      "Life Sciences" = "#0070C0", 
                                      "Marketing" = "#BFBFBF", 
                                      "Medical" = "#BFBFBF",
                                      "Other" = "#BFBFBF",
                                      "Technical Degree" = "#BFBFBF")) +
ggplot2::theme(legend.position = "none",
               panel.background = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank(),
               plot.title = element_text(hjust = 0, colour = "#404040", margin = margin(t = 0, r = 0, b = 10, l = 0)),
               axis.title.x = element_text(colour = "#404040", margin = margin(t = 10, r = 0, b = 0, l = 0)),
               axis.title.y = element_text(colour = "#404040", margin = margin(t = 0, r = 10, b = 0, l = 0)))

```

### Step 10: Sort Data along Flipped Axis

  We can further simplify this visual for our audience by sorting the bars from highest to lowest, and flipping the coordinates of the bar chart. Flipping the coordinates allows the audience to more easily scan down the right side of the visual to quickly identify and understand the relative frequencies of education categories.
  
  We can use `dplyr` to sort the data and define the levels of `ed_field`.
  
```{r, message = FALSE, warning = FALSE}

# Sort education values by avg annual comp
smmry_ed_field <- smmry_ed_field %>%
                  dplyr::arrange(n)

smmry_ed_field$ed_field <- factor(smmry_ed_field$ed_field, levels = smmry_ed_field$ed_field)

```

  We can now visualize the sorted data with flipped coordinates using `coord_flip()`:

```{r barchart_10, out.width = "100%", echo = FALSE, fig.cap = 'Step 10: Sort data along flipped axis.', fig.align = 'center', message = FALSE, warning = FALSE}

# Visualize data
ggplot2::ggplot(smmry_ed_field, aes(x = ed_field, y = n, fill = as.factor(ed_field))) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::coord_flip() +
ggplot2::labs(title = 'Life Sciences is the most common education field \npursued by active employees.', x = 'Education Field', y = 'Headcount') +
ggplot2::scale_fill_manual(values = c("Human Resources" = "#BFBFBF", 
                                      "Life Sciences" = "#0070C0", 
                                      "Marketing" = "#BFBFBF", 
                                      "Medical" = "#BFBFBF",
                                      "Other" = "#BFBFBF",
                                      "Technical Degree" = "#BFBFBF")) +
ggplot2::theme(legend.position = "none",
               panel.background = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank(),
               plot.title = element_text(hjust = 0, colour = "#404040", margin = margin(t = 0, r = 0, b = 10, l = 0)),
               axis.title.x = element_text(colour = "#404040", margin = margin(t = 10, r = 0, b = 0, l = 0)),
               axis.title.y = element_text(colour = "#404040", margin = margin(t = 0, r = 10, b = 0, l = 0)))

```

  The final visual is a marked improvement over the design defaults in step 1.

```{r pre-post-declutter, out.width = "100%", fig.cap = "Top: Enhanced design. Bottom: Design defaults.", fig.align = 'center', warning = FALSE, message = FALSE}

viz_pre <- ggplot2::ggplot(smmry_ed_field, aes(x = ed_field, y = n, fill = as.factor(ed_field))) +
           ggplot2::geom_bar(stat = "identity") 

viz_post <- ggplot2::ggplot(smmry_ed_field, aes(x = ed_field, y = n, fill = as.factor(ed_field))) +
            ggplot2::geom_bar(stat = "identity") +
            ggplot2::coord_flip() +
            ggplot2::labs(title = 'Life Sciences is the most common education field \npursued by active employees.', x = 'Education Field', y = 'Headcount') +
            ggplot2::scale_fill_manual(values = c("Human Resources" = "#BFBFBF", 
                                                  "Life Sciences" = "#0070C0", 
                                                  "Marketing" = "#BFBFBF", 
                                                  "Medical" = "#BFBFBF",
                                                  "Other" = "#BFBFBF",
                                                  "Technical Degree" = "#BFBFBF")) +
            ggplot2::theme(legend.position = "none",
                           panel.background = element_blank(),
                           axis.ticks.x = element_blank(),
                           axis.ticks.y = element_blank(),
                           plot.title = element_text(hjust = 0, colour = "#404040", margin = margin(t = 0, r = 0, b = 10, l = 0)),
                           axis.title.x = element_text(colour = "#404040", margin = margin(t = 10, r = 0, b = 0, l = 0)),
                           axis.title.y = element_text(colour = "#404040", margin = margin(t = 0, r = 10, b = 0, l = 0)))
  
# Display distribution visualizations
ggpubr::ggarrange(viz_post, viz_pre, ncol = 1, nrow = 2)

```

## Visualization Types



### Tables



### Heatmaps



### Scatterplots

  

### Line Graphs



```{r, message = FALSE, warning = FALSE}

# Load data
turnover <- read.csv("https://raw.githubusercontent.com/crstarbuck/peopleanalytics_book/master/data/turnover_trends.csv")

```

  **Single Series**

```{r single-line-graph, out.width = "100%", echo = FALSE, fig.cap = 'Single series line graph.', fig.align = 'center', message = FALSE, warning = FALSE}

# Subset data
sl_data <- subset(turnover, year == 5 & job == 'People Scientist' & level == 4 & remote == 'Yes')

# Visualize data
ggplot2::ggplot(sl_data, aes(x = month, y = turnover_rate * .01)) + 
ggplot2::labs(title = "The trailing 12-month (TTM) turnover for level 4 People Scientists \nhas trended up over the past year.", x = 'Month', y = 'Turnover Rate') + 
ggplot2::geom_line(col = "#0080FF", size = 1.5) +
ggplot2::scale_x_continuous(breaks = 1:12) +
ggplot2::scale_y_continuous(labels = scales::percent) +
ggplot2::theme(panel.background = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank(),
               plot.title = element_text(hjust = 0, colour = "#404040", margin = margin(t = 0, r = 0, b = 10, l = 0)),
               axis.title.x = element_text(colour = "#404040", margin = margin(t = 10, r = 0, b = 0, l = 0)),
               axis.title.y = element_text(colour = "#404040", margin = margin(t = 0, r = 10, b = 0, l = 0)))


```
  
  **Two Series**
  
```{r double-line-graph, out.width = "100%", echo = FALSE, fig.cap = 'Two series line graph.', fig.align = 'center', message = FALSE, warning = FALSE}

# Subset data
tl_data <- subset(turnover, year == 5 & job %in% c('People Scientist', 'Data Engineer') & level == 4 & remote == 'Yes')

# Ordered factor for consistent legend value sorting
tl_data$job <- factor(tl_data$job, levels = c("People Scientist", "Data Engineer"))

# Visualize data
ggplot2::ggplot(tl_data, aes(x = month, y = turnover_rate * .01, colour = job)) + 
ggplot2::labs(title = "The trailing 12-month (TTM) turnover trends for level 4 People Scientists \nand Data Engineers diverged over the past year.", x = 'Month', y = 'Turnover Rate', col = 'Job') + 
ggplot2::geom_line(size = 1.5) +
ggplot2::scale_color_manual(values = c("#0080FF", "#B8BDBF")) +
ggplot2::scale_x_continuous(breaks = 1:12) +
ggplot2::scale_y_continuous(labels = scales::percent) +
ggplot2::theme(panel.background = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank(),
               plot.title = element_text(hjust = 0, colour = "#404040", margin = margin(t = 0, r = 0, b = 10, l = 0)),
               axis.title.x = element_text(colour = "#404040", margin = margin(t = 10, r = 0, b = 0, l = 0)),
               axis.title.y = element_text(colour = "#404040", margin = margin(t = 0, r = 10, b = 0, l = 0)))


```
  
  **Multiple Series**
  
```{r multi-line-graph, out.width = "100%", echo = FALSE, fig.cap = 'Multiple series line graph.', fig.align = 'center', message = FALSE, warning = FALSE}

# Subset data
ml_data <- subset(turnover, year == 5 & job %in% c('People Scientist', 'Data Engineer', 'Insights Consultant') & level == 4 & remote == 'Yes')

# Ordered factor for consistent legend value sorting
ml_data$job <- factor(ml_data$job, levels = c("People Scientist", "Data Engineer", "Insights Consultant"))

# Visualize data
ggplot2::ggplot(ml_data, aes(x = month, y = turnover_rate * .01, colour = job)) + 
ggplot2::labs(title = "The trailing 12-month (TTM) turnover trend for level 4 People Scientists \ndiverged from Data Engineers and Insights Consultants over the past year.", x = 'Month', y = 'Turnover Rate') + 
ggplot2::geom_line(size = 1.5) +
ggplot2::scale_color_manual(values=c("#0080FF", "#B8BDBF", "#E2E5E5")) +
ggplot2::scale_x_continuous(breaks = 1:12) +
ggplot2::scale_y_continuous(labels = scales::percent) +
ggplot2::theme(panel.background = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank(),
               plot.title = element_text(hjust = 0, colour = "#404040", margin = margin(t = 0, r = 0, b = 10, l = 0)),
               axis.title.x = element_text(colour = "#404040", margin = margin(t = 10, r = 0, b = 0, l = 0)),
               axis.title.y = element_text(colour = "#404040", margin = margin(t = 0, r = 10, b = 0, l = 0)))

```
  
### Slopegraphs



### Bar Charts

  **Vertical**
  
```{r hbar_chart, out.width = "100%", echo = FALSE, fig.cap = 'Horizontal bar chart.', fig.align = 'center', message = FALSE, warning = FALSE}

# Sort education values by avg annual comp
smmry_ed_field <- smmry_ed_field %>%
                  dplyr::arrange(desc(n))
smmry_ed_field$ed_field <- factor(smmry_ed_field$ed_field, levels = smmry_ed_field$ed_field)

# Visualize data
ggplot2::ggplot(smmry_ed_field, aes(x = ed_field, y = n, fill = as.factor(ed_field))) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::labs(title = 'Life Sciences is the most common education field \npursued by active employees.', x = 'Education Field', y = 'Headcount') +
ggplot2::scale_fill_manual(values = c("Human Resources" = "#BFBFBF", 
                                      "Life Sciences" = "#0070C0", 
                                      "Marketing" = "#BFBFBF", 
                                      "Medical" = "#BFBFBF",
                                      "Other" = "#BFBFBF",
                                      "Technical Degree" = "#BFBFBF")) +
ggplot2::theme(legend.position = "none",
               panel.background = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank(),
               plot.title = element_text(hjust = 0, colour = "#404040", margin = margin(t = 0, r = 0, b = 10, l = 0)),
               axis.title.x = element_text(colour = "#404040", margin = margin(t = 10, r = 0, b = 0, l = 0)),
               axis.title.y = element_text(colour = "#404040", margin = margin(t = 0, r = 10, b = 0, l = 0)))

```
  
  **Horizontal**
  

```{r hbar_chart, out.width = "100%", echo = FALSE, fig.cap = 'Horizontal bar chart.', fig.align = 'center', message = FALSE, warning = FALSE}

# Sort education values by avg annual comp
smmry_ed_field <- smmry_ed_field %>%
                  dplyr::arrange(n)
smmry_ed_field$ed_field <- factor(smmry_ed_field$ed_field, levels = smmry_ed_field$ed_field)

# Visualize data
ggplot2::ggplot(smmry_ed_field, aes(x = ed_field, y = n, fill = as.factor(ed_field))) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::coord_flip() +
ggplot2::labs(title = 'Life Sciences is the most common education field \npursued by active employees.', x = 'Education Field', y = 'Headcount') +
ggplot2::scale_fill_manual(values = c("Human Resources" = "#BFBFBF", 
                                      "Life Sciences" = "#0070C0", 
                                      "Marketing" = "#BFBFBF", 
                                      "Medical" = "#BFBFBF",
                                      "Other" = "#BFBFBF",
                                      "Technical Degree" = "#BFBFBF")) +
ggplot2::theme(legend.position = "none",
               panel.background = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank(),
               plot.title = element_text(hjust = 0, colour = "#404040", margin = margin(t = 0, r = 0, b = 10, l = 0)),
               axis.title.x = element_text(colour = "#404040", margin = margin(t = 10, r = 0, b = 0, l = 0)),
               axis.title.y = element_text(colour = "#404040", margin = margin(t = 0, r = 10, b = 0, l = 0)))

```

  **Stacked**
  
  
  
### Waterfall Charts



### Area Charts



### Pie Charts

  Pie charts are rarely an effective way to visualize data, and this book does not generally endorse them. However, pie charts can be appropriate in cases where there are two or three mutually exclusive groups and we need to visualize the relative contribution of each to the whole. However, it quickly becomes difficult to ascertain relative size beyond a few groups with a pie chart, and labeling many slices adds a lot of clutter and noise. Proportions should always sum to 1 so if data are not mutually exclusive parts of a whole, a pie chart is not appropriate. 
  
  There is no specific `geom()` function for building pie charts using `ggplot2`. Therefore, we need to create a bar chart and make it circular by adding a `coord_polar("y", start = 0)` transformation. The `coord_polar()` transformation complicates the positioning of labels, but we can add a `position = position_stack(vjust = 0.5))` argument within the `geom_text()` function to specify the alignment of gender representation metrics. We can also easily improve the aesthetics with the `theme_void()` function, which removes the default background, grid, and labels.

```{r pie-chart, out.width = "100%", fig.cap = 'Pie chart showing gender representation for active employees.', fig.align = 'center', message = FALSE, warning = FALSE}

# Create data cube for gender representation among active employees
smmry_gender <- employees %>%
                dplyr::filter(active == 'Yes') %>%
                dplyr::group_by(gender) %>%
                dplyr::summarise(cnt = n()) %>%
                dplyr::mutate(pct = round(cnt / sum(cnt) * 100, 1)) %>%
                dplyr::arrange(desc(pct))

# Visualize data
ggplot2::ggplot(smmry_gender, aes(x = "", y = pct, fill = as.factor(gender))) +
ggplot2::geom_bar(stat = "identity") +
ggplot2::coord_polar("y", start = 0) +
ggplot2::geom_text(aes(label = paste0(pct, "%")), color = ifelse(smmry_gender$gender == 'Male', 'white', 'black'), position = position_stack(vjust = 0.5)) +
ggplot2::labs(title = 'Nearly 60 percent of active employees identify as male.') +
ggplot2::scale_fill_manual(values = c("Female" = "#BFBFBF", 
                                      "Male" = "#0070C0")) +
ggplot2::theme_void() +
ggplot2::theme(legend.title = element_blank(),
               panel.background = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank(),
               plot.title = element_text(colour = "#404040"))

```

## Deceptive Visuals



### 3D Visuals

  3D visualizations are never appropriate. 3D visuals are deceptive and misrepresent the data they are intended to visualize.
  
  The 3D pie chart is at the top of the list of bad data visualizations. Figure \@ref(fig:3d-pie-chart) shows the distribution of headcount across locations using a 3D pie chart. Based on this visual, it may not be apparent that Los Angeles (25%) is considerably larger than New York (19%). The misleading perspective of this tilted visual causes locations on the back side of the pie chart to appear smaller relative to locations on the front side.

```{r 3d-pie-chart, out.width = "75%", echo = FALSE, fig.cap = 'Headcount by location misrepresented with a 3D pie chart.', fig.align = 'center'}

knitr::include_graphics("/Users/craig.starbuck/Library/Mobile Documents/com~apple~CloudDocs/Documents/People Analytics Book/GitHub/peopleanalytics_book/graphics/3d_pie_chart.png")

```

  A 3D bar chart is not an improvement over a 3D pie chart. As illustrated in Figure \@ref(fig:3d-bar-chart), bars do not appear to align with the actual corresponding values (e.g., Los Angeles = 25%). This is because software determines the height of bars in a 3D bar chart using an invisible tangent plane to intersect the bars at the correct y-axis location. 

```{r 3d-bar-chart, out.width = "75%", echo = FALSE, fig.cap = 'Headcount by location visualized with a misleading 3D bar chart.', fig.align = 'center'}

knitr::include_graphics("/Users/craig.starbuck/Library/Mobile Documents/com~apple~CloudDocs/Documents/People Analytics Book/GitHub/peopleanalytics_book/graphics/3d_bar_chart.png")

```

  As shown in Figure \@ref(fig:3d-bar-chart_conv), by leveraging a horizontal bar chart with labeled bars and preattentive attributes, it becomes easy to understand relative headcount across locations.

```{r 3d-bar-chart-conv, out.width = "75%", echo = FALSE, fig.cap = 'Headcount by location properly visualized with a horizontal bar chart.', fig.align = 'center'}

knitr::include_graphics("/Users/craig.starbuck/Library/Mobile Documents/com~apple~CloudDocs/Documents/People Analytics Book/GitHub/peopleanalytics_book/graphics/horizontal_bar_chart.png")

```



```{r bad-viz-1, out.width = "75%", echo = FALSE, fig.cap = 'Deceiving cumulative sales trend.', fig.align = 'center'}

knitr::include_graphics("/Users/craig.starbuck/Library/Mobile Documents/com~apple~CloudDocs/Documents/People Analytics Book/GitHub/peopleanalytics_book/graphics/bad_viz-cumulative_trend.png")

```


```{r bad-viz-2, out.width = "75%", echo = FALSE, fig.cap = 'Misleading inverted y-axis.', fig.align = 'center'}

knitr::include_graphics("/Users/craig.starbuck/Library/Mobile Documents/com~apple~CloudDocs/Documents/People Analytics Book/GitHub/peopleanalytics_book/graphics/bad_viz-flipped_y_axis.png")

```


```{r bad-viz-3, out.width = "75%", echo = FALSE, fig.cap = 'Improper use of a donut chart.', fig.align = 'center'}

knitr::include_graphics("/Users/craig.starbuck/Library/Mobile Documents/com~apple~CloudDocs/Documents/People Analytics Book/GitHub/peopleanalytics_book/graphics/bad_viz-pie_chart.png")

```


```{r bad-viz-4, out.width = "75%", echo = FALSE, fig.cap = 'Apples-to-oranges trend comparison.', fig.align = 'center'}

knitr::include_graphics("/Users/craig.starbuck/Library/Mobile Documents/com~apple~CloudDocs/Documents/People Analytics Book/GitHub/peopleanalytics_book/graphics/bad_viz-diminishing_ed_returns.png")

```



```{r good-viz, out.width = "75%", echo = FALSE, fig.cap = 'Masterfully constructed bar chart.', fig.align = 'center'}

knitr::include_graphics("/Users/craig.starbuck/Library/Mobile Documents/com~apple~CloudDocs/Documents/People Analytics Book/GitHub/peopleanalytics_book/graphics/good_viz-job_loss.png")

```

## Review Questions

1. 

2. 

3. 

4. 

5. 

6. 

7. 

8. 

9. 

10. 